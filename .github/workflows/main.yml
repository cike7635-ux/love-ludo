name: ğŸ”„ æ›´æ–° pnpm é”æ–‡ä»¶

on:
  # æ­¤å·¥ä½œæµä»…åœ¨ä»“åº“é¡µé¢çš„Actionsæ ‡ç­¾é¡µä¸­æ‰‹åŠ¨è§¦å‘ï¼Œä¸ä¼šè‡ªåŠ¨è¿è¡Œ
  workflow_dispatch:

jobs:
  update-lock:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ—ï¸ å®‰è£… PNPM (æŒ‡å®šç‰ˆæœ¬é¿å…é”™è¯¯)
        uses: pnpm/action-setup@v4
        with:
          version: 8.15.0

      - name: âš™ï¸ è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–å¹¶æ›´æ–°é”æ–‡ä»¶
        run: pnpm install

      - name: ğŸ’¾ æäº¤æ›´æ–°åçš„é”æ–‡ä»¶
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add pnpm-lock.yaml
          # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–ï¼Œæœ‰å˜åŒ–æ‰æäº¤
          if git diff --staged --quiet; then
            echo "æ²¡æœ‰æ£€æµ‹åˆ°é”æ–‡ä»¶å˜åŒ–ï¼Œæ— éœ€æäº¤ã€‚"
          else
            git commit -m "chore: ç”± GitHub Actions è‡ªåŠ¨æ›´æ–° pnpm-lock.yaml"
            git push
            echo "é”æ–‡ä»¶å·²æ›´æ–°å¹¶æ¨é€ã€‚"
          fi
